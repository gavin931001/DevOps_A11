name: Deploy to GitHub Pages and Security Check

on:
  push:
    branches: [ "main" ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # 演示 Secret Management (報告重點截圖處)
      # 我們從 GitHub Secrets 讀取 DEPLOY_TOKEN，而不是寫死在檔案裡
      - name: Print Secret Status (Do not print actual secret!)
        env:
          # 這裡對應到你在 GitHub Settings > Secrets 設定的變數
          MY_SECRET_TOKEN: ${{ secrets.DEPLOY_TOKEN }} 
        run: |
          if [ -z "$MY_SECRET_TOKEN" ]; then
            echo "Error: Secret is not set."
          else
            echo "Success: Secret injected securely into the CI pipeline."
          fi

      # 演示自動化部署到 GitHub Pages
      - name: Setup Pages
        uses: actions/configure-pages@v3
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: '.'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»å‹•å ±å - DevSecOps ç ”è¨æœƒ</title>
    <style>
        /* åŸºç¤æ¨£å¼ (Designer å¯ä»¥æˆªåœ–èªªæ˜ UI/UX) */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f4f7f6; margin: 0; }
        .container { background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 100%; max-width: 450px; position: relative; }
        
        /* æ¨™é¡Œèˆ‡å°è¦½ */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h2 { margin: 0; color: #2c3e50; font-size: 1.5rem; }
        .logout-btn { background: none; border: 1px solid #ccc; padding: 5px 10px; border-radius: 4px; cursor: pointer; color: #666; font-size: 0.8rem; }
        .logout-btn:hover { background: #eee; color: #333; }

        /* è¡¨å–®æ¨£å¼ */
        .form-group { margin-bottom: 1.2rem; }
        label { display: block; margin-bottom: .5rem; color: #555; font-weight: 500; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; transition: border-color 0.3s; }
        input:focus { border-color: #007bff; outline: none; }
        
        /* ä¸»è¦æŒ‰éˆ• */
        .submit-btn { width: 100%; padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600; margin-top: 10px; transition: background 0.3s; }
        .submit-btn:hover { background-color: #0056b3; }

        /* ========================================= */
        /* [Feature A] å€’æ•¸è¨ˆæ™‚å™¨æ¨£å¼ (Hypothesis 1) */
        /* ========================================= */
        .timer-alert { 
            background-color: #fff5f5; 
            color: #e53e3e; 
            padding: 12px; 
            border-radius: 6px; 
            margin-bottom: 20px; 
            text-align: center; 
            font-weight: bold; 
            border: 1px solid #fed7d7; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(229, 62, 62, 0); }
            100% { box-shadow: 0 0 0 0 rgba(229, 62, 62, 0); }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2>ğŸ“ ç ”è¨æœƒå ±åè¡¨</h2>
        <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
    </header>

    <div id="countdown-section" style="display: none;">
        <div class="timer-alert">
            <span>ğŸ”¥ åé¡å‘Šæ€¥ï¼å‰©é¤˜æ™‚é–“</span>
            <span id="time" style="font-family: monospace; font-size: 1.2em;">05:00</span>
        </div>
    </div>

    <form id="registration-form" onsubmit="handleSubmit(event)">
        <div id="form-fields">
            </div>
        
        <button type="submit" class="submit-btn">ç«‹å³ä¿ç•™å¸­ä½</button>
    </form>
</div>

<script>
    // =========================================================
    // 1. [Security A&A] èº«åˆ†é©—è­‰æª¢æŸ¥ (Authorization Check)
    // =========================================================
    // æª¢æŸ¥ Session ä¸­æ˜¯å¦æœ‰ Tokenï¼Œå¦‚æœæ²’æœ‰ï¼Œè¸¢å›ç™»å…¥é 
    const token = sessionStorage.getItem('auth_token');
    if (!token) {
        // ç‚ºäº†ä½¿ç”¨è€…é«”é©—ï¼Œå¯ä»¥å…ˆéš±è— body å…§å®¹é¿å…é–ƒçˆ (é€™è£¡ç°¡å–®è™•ç†ç›´æ¥è·³è½‰)
        alert('â›” æœªæˆæ¬Šå­˜å–ï¼è«‹å…ˆé€²è¡Œç™»å…¥ã€‚');
        window.location.href = 'index.html'; // å¼·åˆ¶å°å›é¦–é 
    }

    // =========================================================
    // 2. [DevSecOps] åŠŸèƒ½é–‹é—œé…ç½® (Feature Toggles Configuration)
    // =========================================================
    // å ±å‘Šæˆªåœ–é‡é»ï¼šä¿®æ”¹é€™è£¡çš„ true/false ä¾†æ¨¡æ“¬ä¸åŒç‰ˆæœ¬çš„ç™¼å¸ƒ
    const featureFlags = {
        // å‡è¨­ä¸€ï¼šåŠ å…¥å€’æ•¸è¨ˆæ™‚å™¨èƒ½å¢åŠ æ€¥è¿«æ„Ÿ (Urgency)
        ENABLE_COUNTDOWN_TIMER: true,  
        
        // å‡è¨­äºŒï¼šç°¡åŒ–è¡¨å–®èƒ½æé«˜å¡«å¯«ç‡ (Frictionless)
        // Set to true = æ¥µç°¡ç‰ˆ (åªæœ‰ Email)
        // Set to false = å®Œæ•´ç‰ˆ (å§“åã€é›»è©±ã€å–®ä½...)
        ENABLE_SIMPLE_FORM: false
    };

    // =========================================================
    // 3. [Logic] æ ¹æ“šé–‹é—œæ¸²æŸ“ç•«é¢ (Feature Implementation)
    // =========================================================

    // --- è™•ç†å‡è¨­ä¸€ï¼šå€’æ•¸è¨ˆæ™‚å™¨ ---
    if (featureFlags.ENABLE_COUNTDOWN_TIMER) {
        document.getElementById('countdown-section').style.display = 'block';
        startTimer(5 * 60); // å•Ÿå‹• 5 åˆ†é˜å€’æ•¸
    }

    // --- è™•ç†å‡è¨­äºŒï¼šå‹•æ…‹è¡¨å–®æ¬„ä½ ---
    const formContainer = document.getElementById('form-fields');
    
    if (featureFlags.ENABLE_SIMPLE_FORM) {
        // [Toggle ON] æ¥µç°¡æ¨¡å¼
        console.log("[Feature Toggle Status] Simple Form: ON");
        formContainer.innerHTML = `
            <div class="form-group">
                <label for="email">é›»å­ä¿¡ç®± (Email)</label>
                <input type="email" id="email" placeholder="name@example.com" required>
                <small style="color: #666; font-size: 0.8em;">åªéœ€è¼¸å…¥ Email å³å¯å®Œæˆå¿«é€Ÿå ±åã€‚</small>
            </div>
        `;
    } else {
        // [Toggle OFF] å®Œæ•´æ¨¡å¼ (å‚³çµ±æµç¨‹)
        console.log("[Feature Toggle Status] Simple Form: OFF");
        formContainer.innerHTML = `
            <div class="form-group">
                <label for="name">çœŸå¯¦å§“å (Full Name)</label>
                <input type="text" id="name" placeholder="è«‹è¼¸å…¥å§“å" required>
            </div>
            <div class="form-group">
                <label for="phone">è¯çµ¡é›»è©± (Phone)</label>
                <input type="tel" id="phone" placeholder="09xx-xxx-xxx" required>
            </div>
            <div class="form-group">
                <label for="org">æ‰€å±¬å–®ä½ (Organization)</label>
                <input type="text" id="org" placeholder="å­¸æ ¡æˆ–å…¬å¸åç¨±" required>
            </div>
            <div class="form-group">
                <label for="email">é›»å­ä¿¡ç®± (Email)</label>
                <input type="email" id="email" placeholder="name@example.com" required>
            </div>
        `;
    }

    // =========================================================
    // 4. [Utilities] è¼”åŠ©åŠŸèƒ½
    // =========================================================

    // å€’æ•¸è¨ˆæ™‚å™¨é‚è¼¯
    function startTimer(duration) {
        let timer = duration, minutes, seconds;
        const display = document.querySelector('#time');
        
        const intervalId = setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;

            if (--timer < 0) {
                clearInterval(intervalId);
                display.textContent = "00:00";
                alert("âš ï¸ å ±åæ™‚é–“å·²æˆªæ­¢ï¼(æ¨¡æ“¬)");
            }
        }, 1000);
    }

    // è™•ç†è¡¨å–®é€å‡º
//    function handleSubmit(event) {
//        event.preventDefault();
        // é€™è£¡å¯ä»¥æ¥ APIï¼Œç›®å‰ç”¨ Alert æ¨¡æ“¬æˆåŠŸ
//        alert('ğŸ‰ å ±åæˆåŠŸï¼è³‡æ–™å·²é€å‡ºã€‚');
//    }

    // =========================================================
    // 4. [Data Collection] Google Forms ä¸²æ¥ (Mock Backend)
    // =========================================================
    
//    function handleSubmit(event) {
//        event.preventDefault(); // é˜»æ­¢ç€è¦½å™¨è·³é 

        // 1. æº–å‚™è¦é€å‡ºçš„è³‡æ–™
        // æ³¨æ„ï¼šé€™è£¡çš„ ID å¿…é ˆæ›æˆä½ è‡ªå·± Google Form çš„ entry.xxxxxx
//        const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeRMY2bHfChtkKF9oDw-pIJknCf95SACgEStZxJqh0LUDV75Q/formResponse'; 
//        const FIELD_EMAIL_ID = 'entry.135039649';   // æ›æˆä½ çš„ Email æ¬„ä½ ID
//        const FIELD_VERSION_ID = 'entry.1644182510'; // æ›æˆä½ çš„ Version æ¬„ä½ ID

        // å–å¾—ä½¿ç”¨è€…è¼¸å…¥çš„ Email
//        const userEmail = document.getElementById('email').value;
        
        // åˆ¤æ–·ç•¶å‰æ˜¯ç”¨å“ªå€‹ç‰ˆæœ¬ (ç‚ºäº†åš A/B Testing æ•¸æ“šåˆ†æ)
//        const currentVersion = featureFlags.ENABLE_SIMPLE_FORM ? "Simple_Form_v2" : "Full_Form_v1";

        // 2. å»ºç«‹ FormData ç‰©ä»¶
//        const formData = new FormData();
//        formData.append(FIELD_EMAIL_ID, userEmail);
//        formData.append(FIELD_VERSION_ID, currentVersion);

        // 3. ä½¿ç”¨ fetch ç™¼é€è«‹æ±‚ (Mode: no-cors æ˜¯é—œéµ)
        // å› ç‚º Google ä¸å…è¨±è·¨ç¶²åŸŸè®€å–å›æ‡‰ï¼Œæˆ‘å€‘è¨­ç‚º no-cors 
        // é€™æ¨£é›–ç„¶çœ‹ä¸åˆ°æˆåŠŸè¨Šæ¯ï¼Œä½†è³‡æ–™å¯¦éš›ä¸Šæœƒé€é€²å»
//        fetch(GOOGLE_FORM_URL, {
//            method: 'POST',
//            body: formData,
//            mode: 'no-cors' 
//        }).then(() => {
            // æˆåŠŸå¾Œçš„å‹•ä½œ
//            alert('ğŸ‰ å ±åæˆåŠŸï¼è³‡æ–™å·²é€å‡ºï¼Œå³å°‡å›åˆ°ç™»å…¥é é¢ã€‚');
            
            // 1. [Security] æ¸…é™¤ Session (è‡ªå‹•ç™»å‡º)
//            sessionStorage.removeItem('auth_token');
            
            // 2. [Redirect] è·³è½‰å›ç™»å…¥é  (index.html)
//            window.location.href = 'index.html';
//        }).catch((error) => {
//            console.error('Error:', error);
//            alert('âš ï¸ ç³»çµ±å¿™ç¢Œä¸­ï¼Œä½†æ‚¨çš„è«‹æ±‚å¯èƒ½å·²ç´€éŒ„ã€‚');
//        });
//    }

    function handleSubmit(event) {
        event.preventDefault(); 

        // ğŸŸ¢ ä¿®æ”¹é» 1: æ›æˆä½  Render çš„çœŸå¯¦å¾Œç«¯ç¶²å€
        // æ³¨æ„ï¼šç¶²å€å¾Œé¢è¦åŠ  /register
        const API_URL = 'https://devops-a11.onrender.com/register'; 

        const userEmail = document.getElementById('email').value;
        const currentVersion = featureFlags.ENABLE_SIMPLE_FORM ? "Simple_Form_v2" : "Full_Form_v1";

        // ğŸŸ¢ ä¿®æ”¹é» 2: ä½¿ç”¨æ¨™æº–çš„ Fetch API ç™¼é€ JSON
        fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                email: userEmail,
                version: currentVersion
            })
        }).then(async response => {
            // æª¢æŸ¥å¾Œç«¯æ˜¯å¦å›å‚³éŒ¯èª¤ (ä¾‹å¦‚ Chaos Mode çš„ 500 Error)
            if (!response.ok) {
                throw new Error("Server Error: " + response.status);
            }
            return response.json();
        }).then(data => {
            // æˆåŠŸé‚è¼¯
            alert('ğŸ‰ å ±åæˆåŠŸï¼(Server ID: ' + data.id + ')');
            sessionStorage.removeItem('auth_token');
            window.location.href = 'index.html';
        }).catch((error) => {
            // ğŸ”´ å¤±æ•—é‚è¼¯ (é€™å°±æ˜¯ Task 3 è¦æˆªåœ–çš„åœ°æ–¹ï¼)
            console.error('Error:', error);
            alert('âš ï¸ å ±åå¤±æ•—ï¼ä¼ºæœå™¨ç™¼ç”ŸéŒ¯èª¤ (Chaos Mode å¯èƒ½é–‹å•Ÿä¸­)');
        });
    }

    // ç™»å‡ºåŠŸèƒ½ (æ¸…é™¤ Session)
    function logout() {
        sessionStorage.removeItem('auth_token');
        window.location.href = 'index.html';
    }
</script>

</body>
</html>
